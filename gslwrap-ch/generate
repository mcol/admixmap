#!/usr/bin/perl -w
use strict;

my @sources = qw( matrix );

my $names = [
	     { type  => 'int',
	       type2 => '_i',
	       type3 => 'INT',
	       gsl   => '_int' },
	     
	     { type  => 'float',
	       type2 => '',
	       type3 => 'FLT',
	       gsl   => '_float' },
	     
	     { type  => 'double',
	       type2 => '_d',
	       type3 => 'DBL',
	       gsl   => '' }
	     ];

my $warning = "/*         DO NOT EDIT THIS FILE!!        */\n";
$warning .=   "/* -- AUTOGENERATED FROM *_source FILE -- */\n";

foreach my $source(@sources){
    foreach my $name (@$names){
	generate($source,$name);
    }
}

sub generate
{
    my ($source,$name) = @_;
    foreach my $ext (qw( cc h )){
	my $src_file  = sprintf('%s_source.%s',$source,$ext);
	my $dest_file = sprintf('%s%s.%s',$source,$name->{type2},$ext);
	open(SRC,"< $src_file") or die($!);
	open(DEST,"> $dest_file") or die($!);
	print DEST $warning;
	while(defined(my $line=<SRC>)){
	    chomp($line);
	    $line =~ s/%GSL%/$name->{gsl}/g;
	    $line =~ s/%TYPE%/$name->{type}/g;
	    $line =~ s/%TYPE2%/$name->{type2}/g;
	    $line =~ s/%TYPE3%/$name->{type3}/g;
	    print DEST "$line\n";
	}
	close(DEST) or warn($!);
	close(SRC) or warn($!);
    }
}
